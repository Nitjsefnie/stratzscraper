<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Progress Graph</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <style>
      .graph-container {
        max-width: 1400px;
        width: 100%;
        margin: 2rem auto;
        padding: 1.5rem;
      }
      .graph-card {
        background: white;
        border-radius: 0.75rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        padding: 1.5rem;
      }
      .graph-header {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
      }
      .graph-actions {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
      }
      .graph-actions a,
      .graph-actions button {
        text-decoration: none;
        border: none;
        border-radius: 0.5rem;
        padding: 0.6rem 1rem;
        font-weight: 600;
        font-size: 0.95rem;
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        cursor: pointer;
        background: rgba(31, 120, 255, 0.1);
        color: #1f78ff;
      }
      .graph-actions a:hover,
      .graph-actions button:hover {
        background: rgba(31, 120, 255, 0.16);
      }
      .graph-filter {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        align-items: flex-end;
        margin-bottom: 0.5rem;
      }
      .graph-filter label {
        display: flex;
        flex-direction: column;
        font-size: 0.85rem;
        color: #5f6368;
        gap: 0.35rem;
      }
      .graph-filter input {
        padding: 0.5rem 0.75rem;
        border-radius: 0.5rem;
        border: 1px solid rgba(60, 64, 67, 0.2);
        font-size: 0.95rem;
      }
      .graph-filter button,
      .graph-filter a {
        padding: 0.6rem 1rem;
        border-radius: 0.5rem;
        font-weight: 600;
        font-size: 0.95rem;
        text-decoration: none;
        cursor: pointer;
      }
      .graph-filter button.primary {
        background: #1f78ff;
        color: white;
        border: none;
      }
      .graph-filter a.secondary {
        background: rgba(31, 120, 255, 0.1);
        color: #1f78ff;
      }
      .graph-filter button.primary:hover {
        background: #155ac7;
      }
      .graph-filter a.secondary:hover {
        background: rgba(31, 120, 255, 0.16);
      }
      .graph-empty {
        color: #5f6368;
        margin: 1rem 0 0;
      }
    </style>
  </head>
  <body>
    <main class="graph-container">
      <div class="graph-card">
        <div class="graph-header">
          <h1>Progress Over Time</h1>
          <div class="graph-actions">
            <a class="secondary" href="{{ url_for('index') }}">⬅ Back to dashboard</a>
            <a class="secondary" href="{{ url_for('leaderboards') }}">View leaderboard</a>
            <button type="button" class="secondary" id="reloadGraph">↻ Reload data</button>
          </div>
          <form class="graph-filter" method="get" action="{{ url_for('progress_graph') }}">
            <label>
              Start time
              <input type="datetime-local" name="start" value="{{ start_value }}">
            </label>
            <label>
              End time
              <input type="datetime-local" name="end" value="{{ end_value }}">
            </label>
            <button type="submit" class="primary">Apply range</button>
            <a class="secondary" href="{{ url_for('progress_graph') }}">Reset</a>
          </form>
          <p class="muted">Snapshots captured every five minutes by the background worker.</p>
        </div>
        {% if snapshots %}
        <canvas id="progressChart" style="max-height: 480px;"></canvas>
        {% else %}
        <p class="graph-empty">No progress snapshots have been recorded yet.</p>
        {% endif %}
      </div>
    </main>
    {% if snapshots %}
    <script id="progress-snapshots-data" type="application/json">{{ snapshots|tojson }}</script>
    <script src="{{ url_for('static', filename='vendor/chart.umd.min.js') }}"></script>
    {% endif %}
    <script src="{{ url_for('static', filename='js/progress_graph.js') }}" defer></script>
  </body>
</html>
